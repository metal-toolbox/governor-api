Group:
  type: object
  description: |
    Represents a group in the Governor system. Core group object returned by group endpoints (GET /groups/:id, POST /groups, etc).
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the group
    name:
      type: string
      description: Name of the group
    slug:
      type: string
      description: URL-friendly identifier for the group
    description:
      type: string
      description: Description of the group
    note:
      type: [string, "null"]
      description: Additional notes or comments about the group
      default: ""
    approver_group:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves membership requests for this group
    created_at:
      type: string
      format: date-time
      description: Timestamp when the group was created
    updated_at:
      type: string
      format: date-time
      description: Timestamp when the group was last updated
    deleted_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the group was soft-deleted, null if active
    members:
      oneOf:
        - type: array
          items:
            type: string
            format: uuid
        - type: 'null'
      description: List of user IDs that are members of this group
    members_direct:
      oneOf:
        - type: array
          items:
            type: string
            format: uuid
        - type: 'null'
      description: List of user IDs that are direct members of this group
    membership_requests:
      oneOf:
        - type: array
          items:
            type: string
            format: uuid
        - type: 'null'
      description: List of user IDs with pending membership requests
    organizations:
      oneOf:
        - type: array
          items:
            type: string
            format: uuid
        - type: 'null'
      description: List of organization IDs this group belongs to
    applications:
      oneOf:
        - type: array
          items:
            type: string
            format: uuid
        - type: 'null'
      description: List of application IDs associated with this group
    metadata:
      type: object
      additionalProperties: true
      description: Additional metadata for the group
  required:
    - id
    - name
    - slug
    - created_at
    - updated_at

GroupMemberRequest:
  type: object
  description: |
    A pending request from a user to join a group or request admin promotion.
    This is an enriched view that includes user and group details for display purposes.
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the membership request
    group_id:
      type: string
      format: uuid
      description: ID of the group being requested
    group_name:
      type: string
      description: Name of the group being requested
    group_slug:
      type: string
      description: Slug of the group being requested
    user_id:
      type: string
      format: uuid
      description: ID of the user making the request
    user_name:
      type: [string, "null"]
      description: Name of the user making the request
    user_email:
      type: [string, "null"]
      format: email
      description: Email of the user making the request
    user_avatar_url:
      type: [string, "null"]
      description: Avatar URL of the user making the request
    created_at:
      type: string
      format: date-time
      description: Timestamp when the request was created
    updated_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the request was last updated
    is_admin:
      type: boolean
      description: Whether admin privileges are being requested
    note:
      type: string
      description: Note or reason provided with the request
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the membership should expire (if approved)
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: When admin privileges should expire (if approved)
    kind:
      type: string
      enum: [new_member, admin_promotion]
      description: Type of request - new_member or admin_promotion
  required:
    - id
    - group_id
    - group_name
    - group_slug
    - user_id
    - user_name
    - user_email
    - created_at
    - updated_at
    - is_admin
    - note
    - kind

GroupRequestUser:
  type: object
  properties:
    id:
      type: string
      format: uuid
    name:
      type: string
    email:
      type: string
      format: email
    avatar_url:
      type: [string, "null"]

GroupRequestGroup:
  type: object
  properties:
    id:
      type: [string, "null"]
      format: uuid
    name:
      type: [string, "null"]
    slug:
      type: [string, "null"]

GroupApproval:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the approval
    user_id:
      type: string
      format: uuid
      description: ID of the user who needs approval
    group_id:
      type: string
      format: uuid
      description: ID of the group involved in the approval
    request_id:
      type: [string, "null"]
      format: uuid
      description: ID of the associated request
    status:
      type: string
      enum: [pending, approved, rejected]
      description: Status of the approval
    created_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the approval was created
    updated_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the approval was last updated
    reason:
      type: [string, "null"]
      description: Reason provided for the approval decision
  required:
    - id
    - user_id
    - group_id
    - status

GroupMembership:
  type: object
  properties:
    id:
      type: string
      description: Unique identifier for the membership
    user_id:
      type: string
      format: uuid
      description: ID of the member
    group_id:
      type: string
      format: uuid
      description: ID of the group
    is_admin:
      type: boolean
      description: Whether the user has admin privileges in this group
    created_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the membership was created
    updated_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the membership was last updated
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when admin privileges expire, if applicable
  required:
    - id
    - user_id
    - group_id
    - is_admin

GroupMember:
  type: object
  description: |
    Represents a user's membership in a group, enriched with user details.
    Used for listing group members (GET /groups/:id/users).
  properties:
    id:
      type: string
      format: uuid
      description: ID of the user
    name:
      type: string
      description: Name of the user
    email:
      type: string
      format: email
      description: Email address of the user
    avatar_url:
      type: string
      description: Avatar URL of the user
    status:
      type: string
      description: Status of the user account
    is_admin:
      type: boolean
      description: Whether the user has admin privileges in this group
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the membership expires, if applicable
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: When admin privileges expire, if applicable
    direct:
      type: boolean
      description: Whether this is a direct membership (not inherited via group hierarchy)
  required:
    - id
    - name
    - email
    - avatar_url
    - status
    - is_admin
    - direct

GroupHierarchy:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the hierarchy relationship
    parent_group_id:
      type: string
      format: uuid
      description: ID of the parent group
    parent_group_slug:
      type: string
      description: Slug of the parent group
    member_group_id:
      type: string
      format: uuid
      description: ID of the member group
    member_group_slug:
      type: string
      description: Slug of the member group
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the hierarchy relationship expires, if applicable
  required:
    - id
    - parent_group_id
    - parent_group_slug
    - member_group_id
    - member_group_slug

AuthenticatedUserGroup:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: ID of the group
    name:
      type: string
      description: Name of the group
    slug:
      type: string
      description: URL-friendly identifier for the group
    description:
      type: [string, "null"]
      description: Description of the group
    note:
      type: [string, "null"]
      description: Additional notes about the group
    approver_group_id:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves membership requests
    created_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the group was created
    updated_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the group was last updated
    organizations:
      oneOf:
        - type: array
          items:
            $ref: '../schemas/organizations.yaml#/Organization'
        - type: 'null'
      description: Organizations this group belongs to
    applications:
      oneOf:
        - type: array
          items:
            $ref: '../schemas/applications.yaml#/Application'
        - type: 'null'
      description: Applications associated with this group
    admin:
      type: boolean
      description: Whether the authenticated user is an admin of this group
    direct:
      type: boolean
      description: Whether the authenticated user is a direct member of this group
  required:
    - id
    - name
    - slug
    - admin
    - direct

GroupCreateRequest:
  type: object
  description: |
    Request payload for creating a new group (POST /groups). Requires name and slug; description and approver_group_id are optional.
    
    Usage: POST /groups
    
    Validation rules:
    - name: Must be unique
    - slug: Must be unique and URL-safe (lowercase, no spaces, alphanumeric and hyphens only)
    - approver_group_id: Must reference an existing group if provided
    
    Common patterns:
    - For teams: name="Engineering Team", slug="engineering-team"
    - For access control: Set approver_group_id to a management/admin group
  properties:
    name:
      type: string
      description: Name of the group
      examples: ["Engineering Team"]
    slug:
      type: string
      description: URL-friendly identifier for the group
      examples: ["engineering-team"]
    description:
      type: [string, "null"]
      description: Description of the group
      examples: ["The core engineering team responsible for development"]
    note:
      type: [string, "null"]
      description: Additional notes about the group
      examples: ["Contact team lead for more information"]
    approver_group_id:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves membership requests for this group
      examples: ["3fa85f64-5717-4562-b3fc-2c963f66afa6"]
    metadata:
      type: object
      additionalProperties: true
      description: Additional metadata for the group
  required:
    - name
    - slug

GroupUpdateRequest:
  type: object
  description: Request payload for updating an existing group (PUT /groups/:id). All fields are optional for partial updates.
  properties:
    name:
      type: [string, "null"]
      description: Name of the group
    description:
      type: [string, "null"]
      description: Description of the group
    note:
      type: [string, "null"]
      description: Additional notes about the group
    approver_group_id:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves membership requests for this group
    metadata:
      type: object
      additionalProperties: true
      description: Additional metadata for the group. When updating, new keys are merged with existing metadata. To remove a key, set its value to null.

GroupMemberUpdate:
  type: object
  properties:
    is_admin:
      type: boolean
      description: Whether the user should have admin privileges
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: When the admin role should expire (optional)
  required:
    - is_admin

GroupRequestProcessingAction:
  type: object
  properties:
    action:
      type: string
      enum: [approve, deny]
      description: Action to take on the request
  required:
    - action

CreateGroupMemberRequestPayload:
  type: object
  properties:
    is_admin:
      type: [boolean, "null"]
      description: Whether admin privileges are being requested
      default: false
    note:
      type: [string, "null"]
      description: Reason for requesting membership
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the membership should expire (optional)
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: When the admin role should expire (optional)
    kind:
      type: [string, "null"]
      enum: [new_member, admin_promotion]
      default: new_member
      description: Type of request (new membership or admin promotion)

GroupHierarchyRequest:
  type: object
  properties:
    member_group_id:
      type: string
      format: uuid
      description: ID of the group to add as a member
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the hierarchy relationship should expire (optional)
  required:
    - member_group_id

GroupHierarchyUpdate:
  type: object
  properties:
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the hierarchy relationship should expire (optional)

# Group-Applications related schemas
GroupApplication:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the group application link
    group_id:
      type: string
      format: uuid
      description: ID of the group
    application_id:
      type: string
      format: uuid
      description: ID of the application
    created_at:
      type: string
      format: date-time
      description: Timestamp when the link was created
    updated_at:
      type: string
      format: date-time
      description: Timestamp when the link was last updated
  required:
    - id
    - group_id
    - application_id
    - created_at
    - updated_at

GroupApplicationRequest:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the request
    group_id:
      type: string
      format: uuid
      description: ID of the group
    group_name:
      type: [string, "null"]
      description: Name of the group
    group_slug:
      type: [string, "null"]
      description: Slug of the group
    application_id:
      type: string
      format: uuid
      description: ID of the application
    application_name:
      type: [string, "null"]
      description: Name of the application
    application_slug:
      type: [string, "null"]
      description: Slug of the application
    approver_group_id:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves this request
    approver_group_name:
      type: [string, "null"]
      description: Name of the approver group
    approver_group_slug:
      type: [string, "null"]
      description: Slug of the approver group
    requester_user_id:
      type: [string, "null"]
      format: uuid
      description: ID of the user who made the request
    requester_user_name:
      type: [string, "null"]
      description: Name of the requester user
    requester_user_email:
      type: [string, "null"]
      format: email
      description: Email of the requester user
    requester_user_avatar_url:
      type: [string, "null"]
      description: URL to the requester user's avatar image
    note:
      type: [string, "null"]
      description: Additional notes about the request
    created_at:
      type: string
      format: date-time
      description: Timestamp when the request was created
    updated_at:
      type: string
      format: date-time
      description: Timestamp when the request was last updated
  required:
    - id
    - group_id
    - application_id
    - created_at
    - updated_at

GroupApplicationRequestAction:
  type: object
  properties:
    action:
      type: string
      enum: [approve, deny]
      description: Action to take on the application request
  required:
    - action

# Group-Organization relationships
GroupOrganizationLink:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the link
    group_id:
      type: string
      format: uuid
      description: ID of the group
    organization_id:
      type: string
      format: uuid
      description: ID of the organization
    created_at:
      type: string
      format: date-time
      description: Timestamp when the link was created
    updated_at:
      type: string
      format: date-time
      description: Timestamp when the link was last updated
  required:
    - id
    - group_id
    - organization_id
    - created_at
    - updated_at

GroupMembershipRequestWithDetails:
  type: object
  allOf:
    - $ref: '#/GroupMemberRequest'
    - type: object
      properties:
        user:
          $ref: '#/GroupRequestUser'
        group:
          $ref: '#/GroupRequestGroup'

GroupMembershipResponse:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the membership
    status:
      type: string
      enum: [active, expired, revoked]
      description: Current status of the membership
    created_at:
      type: string
      format: date-time
      description: When the membership was created
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the membership expires
  required:
    - id
    - status
    - created_at

CreateGroupRequest:
  type: object
  properties:
    is_admin:
      type: [boolean, "null"]
      description: Whether the request is for admin privileges
    note:
      type: [string, "null"]
      description: Optional note explaining the request
    expires_at:
      type: [string, "null"]
      format: date-time
      description: When the membership should expire (if granted)
    admin_expires_at:
      type: [string, "null"]
      format: date-time
      description: When the admin privileges should expire (if granted)
    kind:
      type: [string, "null"]
      enum: [new_member, admin_promotion]
      description: Type of request - either for new membership or admin promotion
      default: new_member

GroupRequestAction:
  type: object
  required:
    - action
  properties:
    action:
      type: string
      enum: [approve, deny]
      description: Action to take on the group request

CreateGroupApp:
  type: object
  required:
    - name
    - slug
    - description
  properties:
    name:
      type: string
      description: Name of the application
      examples: ["My Application"]
    slug:
      type: string
      description: URL-friendly identifier for the application
      examples: ["my-application"]
    description:
      type: string
      description: Description of the application
      examples: ["A test application for development"]
    type_id:
      type: [string, "null"]
      format: uuid
      description: ID of the application type
      examples: ["123e4567-e89b-12d3-a456-426614174000"]
    approver_group_id:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves access requests for this application
      examples: ["123e4567-e89b-12d3-a456-426614174001"]

GroupListItem:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique identifier for the group
    name:
      type: string
      description: Name of the group
    slug:
      type: string
      description: URL-friendly identifier for the group
    description:
      type: string
      description: Description of the group
    note:
      type: string
      description: Additional notes or comments about the group
      default: ""
    approver_group:
      type: [string, "null"]
      format: uuid
      description: ID of the group that approves membership requests for this group
    created_at:
      type: string
      format: date-time
      description: Timestamp when the group was created
    updated_at:
      type: string
      format: date-time
      description: Timestamp when the group was last updated
    deleted_at:
      type: [string, "null"]
      format: date-time
      description: Timestamp when the group was soft-deleted, null if active
    metadata:
      type: object
      additionalProperties: true
      description: Additional metadata for the group

CreateGroupApplicationRequest:
  type: object
  properties:
    application_id:
      type: string
      format: uuid
      description: ID of the application to link to the group
    note:
      type: [string, "null"]
      description: Additional notes about the request
  required:
    - application_id
