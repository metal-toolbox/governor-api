user-resources:
  post:
    summary: Create an extension resource for the authenticated user
    operationId: createAuthenticatedUserExtensionResource
    parameters:
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
    tags:
      - Extensions
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResource'
    responses:
      '201':
        description: Created
    security:
      - bearerAuth: []  # User authentication only

user-resources-id:
  get:
    summary: Get an extension resource for the authenticated user
    operationId: getAuthenticatedUserExtensionResource
    tags:
      - Extensions
    parameters:
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
    security:
      - bearerAuth: []  # User authentication only

extensions:
  get:
    summary: List extensions
    operationId: listExtensions
    tags:
      - Extensions
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas.yaml#/Extension'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:read']

extensions-id:
  get:
    summary: Get an extension by ID
    operationId: getExtension
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/Extension'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:read']

erds:
  get:
    summary: List extension resource definitions for an extension
    operationId: listExtensionResourceDefinitions
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:read']

  post:
    summary: Create an extension resource definition
    operationId: createExtensionResourceDefinition
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    responses:
      '201':
        description: Created
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:create']

erds-slug:
  get:
    summary: Get an extension resource definition by slug
    operationId: getExtensionResourceDefinitionBySlug
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:read']

  patch:
    summary: Update an extension resource definition by slug
    operationId: updateExtensionResourceDefinitionBySlug
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    responses:
      '200':
        description: Successful response
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:write']

  delete:
    summary: Delete an extension resource definition by slug
    operationId: deleteExtensionResourceDefinitionBySlug
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
    responses:
      '204':
        description: No content
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:delete']

erds-slug-version:
  get:
    summary: Get an extension resource definition by slug and version
    operationId: getExtensionResourceDefinitionBySlugVersion
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:read']

  patch:
    summary: Update an extension resource definition by slug and version
    operationId: updateExtensionResourceDefinitionBySlugVersion
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResourceDefinition'
    responses:
      '200':
        description: Successful response
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:write']

  delete:
    summary: Delete an extension resource definition by slug and version
    operationId: deleteExtensionResourceDefinitionBySlugVersion
    tags:
      - Extensions
    parameters:
      - name: eid
        in: path
        required: true
        schema:
          type: string
      - name: erd-id-slug
        in: path
        required: true
        schema:
          type: string
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
    responses:
      '204':
        description: No content
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensions:delete']

extension-resources:
  post:
    summary: Create an extension resource
    operationId: createExtensionResource
    tags:
      - Extensions
    description: |
      Creates a new extension resource. The extension, kind, and version must be specified in the request body.
      The kind should use the singular slug form of the extension resource definition.
      
      **Owner Reference:**
      - For system-scoped resources, you can optionally specify a group owner via metadata.owner_ref.kind (must be "group") and metadata.owner_ref.id (group UUID)
      - User-scoped resource ownership is not yet supported
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResourceCreateRequest'
          example:
            extension: "my-extension"
            kind: "database"
            version: "v1"
            metadata:
              owner_ref:
                kind: "group"
                id: "550e8400-e29b-41d4-a716-446655440000"
            spec:
              name: "production-db"
              host: "db.example.com"
              port: 5432
    responses:
      '201':
        description: Extension resource created successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
      '400':
        description: Bad Request (invalid owner_ref.kind, validation error, or resource constraint violation)
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  examples:
                    - "owner_ref.kind must be 'group' with system extension resources"
                    - "validation error: resource constraint violation"
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '501':
        description: Not Implemented
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "user-scoped extension resources are not yet supported with this API"
      '500':
        $ref: '../components/responses.yaml#/InternalError'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensionresources:create']

extension-resources-id:
  patch:
    summary: Update an extension resource
    operationId: updateExtensionResource
    tags:
      - Extensions
    description: |
      Updates an existing extension resource. The extension, kind, and version must be specified in the request body.
      The kind should use the singular slug form of the extension resource definition.
      
      **Optimistic Concurrency Control:**
      Optionally, you can provide metadata.resource_version for optimistic concurrency control to ensure the resource
      hasn't been modified since it was last read.
      
      **Status Updates:**
      You can also update status.messages to track resource state changes.
    parameters:
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: Resource ID
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResourceUpdateRequest'
          example:
            extension: "my-extension"
            kind: "database"
            version: "v1"
            metadata:
              owner_ref:
                kind: "group"
                id: "550e8400-e29b-41d4-a716-446655440000"
              resource_version: 1234567890
            spec:
              name: "production-db"
              host: "db.example.com"
              port: 5432
            status:
              messages:
                - '{"message": "Resource updated", "status": "true", "type": "Accepted", "timestamp": "2024-01-01T00:00:00Z"}'
    responses:
      '202':
        description: Extension resource update accepted
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
      '400':
        description: Bad Request (invalid owner_ref.kind, validation error, or resource constraint violation)
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  examples:
                    - "owner_ref.kind must be 'group' with system extension resources"
                    - "validation error: resource constraint violation"
      '401':
        $ref: '../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../components/responses.yaml#/NotFound'
      '409':
        description: Conflict
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "resource version conflict"
      '501':
        description: Not Implemented
        content:
          application/json:
            schema:
              type: object
              properties:
                error:
                  type: string
                  example: "user-scoped extension resources are not yet supported with this API"
      '500':
        $ref: '../components/responses.yaml#/InternalError'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensionresources:update']

resources:
  get:
    summary: List system-wide extension resources
    operationId: listSystemExtensionResources
    tags:
      - Extensions
    parameters:
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas.yaml#/ExtensionResource'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensionresources:read']

resources-id:
  get:
    summary: Get a system-wide extension resource by ID
    operationId: getSystemExtensionResource
    tags:
      - Extensions
    parameters:
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    responses:
      '200':
        description: Successful response
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensionresources:read']

  delete:
    summary: Delete a system-wide extension resource by ID
    operationId: deleteSystemExtensionResource
    tags:
      - Extensions
    parameters:
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    responses:
      '202':
        description: Resource deleted
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:extensionresources:delete']

users-resources:
  post:
    summary: Create extension resource for specific user
    operationId: createUserExtensionResource
    tags:
      - Extensions
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: User ID
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:users:create']
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResource'
    responses:
      '201':
        description: Resource created successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
  
  get:
    summary: List extension resources for specific user
    operationId: listUserExtensionResources
    tags:
      - Extensions
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: User ID
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:users:read']
    responses:
      '200':
        description: Successful operation
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '../components/schemas.yaml#/ExtensionResource'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'

users-resources-id:
  get:
    summary: Get specific extension resource for specific user
    operationId: getUserExtensionResource
    tags:
      - Extensions
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: User ID
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:users:read']
    responses:
      '200':
        description: Successful operation
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

  patch:
    summary: Update specific extension resource for specific user
    operationId: updateUserExtensionResource
    tags:
      - Extensions
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: User ID
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:users:write']
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas.yaml#/ExtensionResource'
    responses:
      '200':
        description: Resource updated successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas.yaml#/ExtensionResource'
      '400':
        $ref: '../openapi.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'

  delete:
    summary: Delete specific extension resource for specific user
    operationId: deleteUserExtensionResource
    tags:
      - Extensions
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: User ID
      - name: ex-slug
        in: path
        required: true
        schema:
          type: string
        description: Extension slug
      - name: erd-slug-plural
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition slug (plural form)
      - name: erd-version
        in: path
        required: true
        schema:
          type: string
        description: Extension resource definition version
      - name: resource-id
        in: path
        required: true
        schema:
          type: string
        description: Resource ID
    security:
      - bearerAuth: []
      - oauth2ClientCredentials: ['governor:users:delete']
    responses:
      '204':
        description: Resource deleted successfully
      '401':
        $ref: '../openapi.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../openapi.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../openapi.yaml#/components/responses/NotFound'
